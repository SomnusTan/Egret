var VersionController=function(){function e(){var e=this;this.resourceRoot="resource/",this.versionPath="assets/",this.versionConfigPath="resource/version.json",this.currentVersion="1.0.7",this.versionCacheWxgame=function(){var t=egret.localStorage.getItem("resVersion");if(t!=e.currentVersion){egret.localStorage.setItem("resVersion",e.currentVersion),GameLog.log("°æ±¾¸üÐÂ");var i=wx.getFileSystemManager(),n=wx.env.USER_DATA_PATH+"/cache_crc32/assets";i.readdir({dirPath:n,success:function(t){for(var o=e.getRemoveList(t.files),a=o.length,s=0;a>s;++s)GameLog.log("É¾³ý",n+"/"+o[s]),i.unlinkSync(n+"/"+o[s])},fail:function(e){}})}},this.versionCacheWeb=function(){}}return e.prototype.init=function(){var e=this;return this.currentVersion=Config.version,new Promise(function(t,i){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.open(e.versionConfigPath,egret.HttpMethod.GET),n.send(),n.addEventListener(egret.Event.COMPLETE,function(i){var n=i.currentTarget;e.versionConfig=JSON.parse(n.response),egret.Capabilities.runtimeType==egret.RuntimeType.WXGAME?e.versionCacheWxgame():egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&e.versionCacheWeb(),t()},e),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){GameLog.log("post error : "+event),i()},e)})},e.prototype.getRemoveList=function(e){var t=[],i="";for(var n in this.versionConfig)i+=this.versionConfig[n]+",";for(var o=e.length,a=0;o>a;++a){var s=e[a],r=s.slice(0,s.indexOf("."));-1==i.indexOf(r)&&t.push(s)}return t},e.prototype.getVirtualUrl=function(e){return this.getResUrlByVersion(e)},e.prototype.getResUrlByVersion=function(e){if(-1==e.indexOf(this.resourceRoot))return e;if(e=e.replace(this.resourceRoot,""),this.versionConfig){var t=e.indexOf("?v=");-1!=t&&(e=e.slice(0,t));var i=e.replace(this.versionPath,"");if(this.versionConfig&&this.versionConfig[i]){var n=this.versionConfig[i],o=e.slice(e.lastIndexOf("."));e=this.versionPath+n+o}}return e=DeviceUtil.IsWeb?this.resourceRoot+e+"?v="+Config.version:this.resourceRoot+e},e}();__reflect(VersionController.prototype,"VersionController",["RES.IVersionController"]),RES.registerVersionController(new VersionController)